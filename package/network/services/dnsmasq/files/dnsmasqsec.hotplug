#!/bin/sh

[ "$ACTION" = "stratum" ] || exit 0

TIMEVALIDFILE="/var/state/dnsmasqsec"

[ -f "$TIMEVALIDFILE" ] || {
	echo "ntpd says time is valid" >$TIMEVALIDFILE
	/etc/init.d/dnsmasq enabled && {
		for pid in $(pidof dnsmasq); do
			[ "$(readlink /proc/$pid/exe)" = "/usr/sbin/dnsmasq" ] && kill -SIGHUP $pid
		done
	}
}
