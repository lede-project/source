From: =?UTF-8?q?Rafa=C5=82=20Mi=C5=82ecki?= <rafal@milecki.pl>
Date: Fri, 27 Feb 2026 19:59:16 +0100
Subject: [PATCH] net: dsa: b53: disable EAP setup on Northstar switches
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

It breaks standalone ports.

Signed-off-by: Rafał Miłecki <rafal@milecki.pl>
---
 drivers/net/dsa/b53/b53_common.c | 15 +++++++++++++++
 1 file changed, 15 insertions(+)

--- a/drivers/net/dsa/b53/b53_common.c
+++ b/drivers/net/dsa/b53/b53_common.c
@@ -332,6 +332,21 @@ static void b53_set_eap_mode(struct b53_
 {
 	u64 eap_conf;
 
+	/*
+	 * On Northstar devices (SoCs with BCM53011 / BCM53012) setting
+	 * EAP_MODE_SIMPLIFIED breaks standalone ports.
+	 *
+	 * See:
+	 * https://lore.kernel.org/netdev/ce4d9b7b-aaf6-4796-94fb-8c3d6a1dcd4d@gmail.com/
+	 * https://github.com/openwrt/openwrt/issues/21187
+	 * https://github.com/openwrt/openwrt/issues/21349
+	 *
+	 * For details on EAP see commit 4227ea91e265 ("net: dsa: b53: prevent
+	 * standalone from trying to forward to other ports").
+	 */
+	if (is5301x(dev))
+		return;
+
 	if (is5325(dev) || is5365(dev) || dev->chip_id == BCM5389_DEVICE_ID)
 		return;
 
